(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{750:function(e,t,n){e.exports={panel:"index__panel___1V9ZN",title:"index__title___2oIH7",chat_icon:"index__chat_icon___3jVUW",chat_title:"index__chat_title___2hPKm",count:"index__count___3xor1",radio:"index__radio___16COT",radio__content:"index__radio__content___1E8bW","radio-close":"index__radio-close___1OMAH",content:"index__content___1lknF","input-box":"index__input-box___30d4n","input-title":"index__input-title___MNFl5","input-container":"index__input-container___16s74",textarea:"index__textarea___1aPIB",textarea_disabled:"index__textarea_disabled___ETOoN","send-btn":"index__send-btn___1kOxb","send-btn-disable":"index__send-btn-disable___defMi",emotion:"index__emotion___1LZpF",words:"index__words___HGdWF","msg-item":"index__msg-item___1lnRj","msg-item-error":"index__msg-item-error___2jMQe","chat-title__me":"index__chat-title__me___xB00k","chat-title__other":"index__chat-title__other___2hX4-",chat_avatar:"index__chat_avatar___wyhr6","chat-name":"index__chat-name___VUOIC","chat-name__me":"index__chat-name__me___13QOE","chat-name__student":"index__chat-name__student___1csor","chat-name__assistant":"index__chat-name__assistant___3Z4iJ","chat-name__teacher":"index__chat-name__teacher___22sCh","chat-name__quality":"index__chat-name__quality___3XU9V","chat-content__me":"index__chat-content__me___j46D7","chat-content__other":"index__chat-content__other___3R1TA","content-img":"index__content-img___1X_8W","list-wrap":"index__list-wrap___1U1OG"}},759:function(e,t,n){e.exports={wrap:"EmotionPanel__wrap___3Jn4J",mask:"EmotionPanel__mask___3-aKS",emotion:"EmotionPanel__emotion___V76ul","emotion-visible":"EmotionPanel__emotion-visible___LX_Ez",appear:"EmotionPanel__appear___1wiR9","emotion-hidden":"EmotionPanel__emotion-hidden___3JqkB",disappear:"EmotionPanel__disappear___1kH7A","emotion-box":"EmotionPanel__emotion-box___2576L","emotion-pages":"EmotionPanel__emotion-pages___3KpKo",page:"EmotionPanel__page___2uaJp",item:"EmotionPanel__item___34QzB","item-empty":"EmotionPanel__item-empty___3ScaW",dots:"EmotionPanel__dots___2qBZ_",dot:"EmotionPanel__dot___3TyaK",active:"EmotionPanel__active___Yw0LY"}},760:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAs9JREFUOBGVVdlxE0EQ7dlLe+jySclQRZGAScE5kAtBEAgREIBTwBHwgTHyISFZu1pL2h3ea3mta2WKrhr1qI83PW96Zo1Azs8v3s0K80WkvLAiPdr+V4zIjYhzGbj289XV5U+zBLXfAXi4DWaMEddriO+H0IG4ridlaSXPRzJ/yrbD9T8WGASu+eixUitWQYNGLH4Qi7UWIL4O+DYAHFckTg5ktAeYBRLT4/arTCtGgiDagDKwUZa/8uyD1bgooKhSt3R54a1zWsxzIBhxELZZ5yqvWiBpH4oFLelkgOByFbDM7aHilZRlIU/5o4RRGxUSwoJfV+KYFIED2OazhWRpjvXpN1IWc5lmoxXI84zFbUg2GQI8ZeEShYF0Oy3Q4+kyhOK8223C19AYD9TVyQ4wg7J0gINDpUkoJQ6yLEvthqXmvICvoV3CuDqpBT5981ZabRwiiGaHWAC/aM6BRH5b7VCazaQOVzY4riKiKBFbAEB5fLZylUoArjwA3HdJ0K7UVpxOxlpVtXVWxzm1DuBUOk0nu6iw1FZ8d/tLgjASz/M1iTTw9FSvwSwWc7ntX69ZVtNaYLqn2USSZmcVucZEZZxO66ulv5YKOh5HQ+0EPTQe4PpQaqzGMLZO9gLP5zMZPvSV24rrF41Fhg+/hTH7ZC8VTMjSsSyQfHRytpF/f3eNG4jr/4q8Csy8GQBYqbYXDxHyL1DG7AA7xpEwxjVuoCt8H3iO3j6QzHiV0957XaxAVzzlU8mzR8RsPkQeuugGKfrV4BvcOTgRBw96JdstRjt7mDtgfJz40ghjGf+5lwIPEoWYODznkn8cx5F292RZoV4Gvgl7BqpXHzWGwevf6h4rBrGI6fAbhRUGSetITUxglZVen1cLrduqOSmLgUEsYrr9/o/xWe/D1yDq9KyRYwS2quuqGotQdPs6W91AgnKoH9t3jfvNziaf+DH9C1IItcqOx+tWAAAAAElFTkSuQmCC"},820:function(e,t,n){"use strict";n.r(t);var a=n(30),o=n.n(a),i=n(31),c=n.n(i),r=n(32),l=n.n(r),s=n(33),_=n.n(s),m=n(34),d=n.n(m),u=n(11),h=n.n(u),p=n(0),v=n.n(p),g=n(2),E=n.n(g),f=n(22),x=n.n(f),b=(n(691),n(692)),S=n(730),w=n(733),C=n.n(w),A=n(738),N=n.n(A),y=n(750),k=n.n(y),T=n(138),I=n.n(T),D=n(23),R=n.n(D),P=n(751),j=n(758),O=n.n(j),H=n(15),V=n(759),W=n.n(V),L=3,U=5,z=L*U,B=document.createElement("div");B.className=W.a.wrap,document.body.appendChild(B);var G=function(e){function t(e){var n;return o()(this,t),(n=l()(this,_()(t).call(this,e))).handleClickIcon=function(e){var t=n.emos[e];n.props.onSelect(t)},n.nextPage=function(){n.state.pageNo>=n.state.pageCount-1||n.setState({pageNo:n.state.pageNo+1})},n.prevPage=function(){n.state.pageNo<=0||n.setState({pageNo:n.state.pageNo-1})},n.handleWheel=Object(H.h)(function(e){var t=e.deltaMode,a=e.deltaX,o=e.deltaY,i=a||o;O()(t)&&i&&(i>0?n.nextPage():n.prevPage())},500),n.handleScroll=function(e){e.preventDefault(),e.stopPropagation()},n.close=function(){n.props.onClose()},n.renderEmos=function(){var e=I()(n),t=e.state.pageCount,a=e.props.emoji,o=e.emos,i=e.handleClickIcon;return new Array(t).fill(0).map(function(e,t){var c=n.emos.slice(t*z,(t+1)*z);return v.a.createElement("div",{className:W.a.page,key:t},c.map(function(e,n){var c=t*z+n;return v.a.createElement("img",{onClick:function(){i(c)},className:W.a.item,src:a[o[c]],key:n,alt:"",title:o[c].replace(/(^\[*)|(\]*$)/g,"")})}))})},n.emos=Object.keys(e.emoji),n.state={pageCount:Math.ceil(n.emos.length/(L*U)),pageNo:0},n}return d()(t,e),c()(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.pageNo,a=t.pageCount,o=this.props.visible,i=this.close,c=this.handleWheel,r=this.handleScroll,l=new Array(a).fill(0);return R.a.createPortal(v.a.createElement(p.Fragment,null,v.a.createElement(P.CSSTransition,{in:o,mountOnEnter:!0,unmountOnExit:!0,timeout:{exit:120},classNames:{enter:W.a["emotion-visible"],exit:W.a["emotion-hidden"]}},v.a.createElement("div",{className:W.a.emotion,onWheel:c,onScroll:r},v.a.createElement("div",{className:W.a["emotion-box"]},v.a.createElement("div",{className:W.a["emotion-pages"],style:{width:200*a,left:200*-n},ref:function(t){e.pages=t}},this.renderEmos())),v.a.createElement("ul",{className:W.a.dots},l.map(function(t,a){return v.a.createElement("li",{className:x()(W.a.dot,h()({},W.a.active,a===n)),key:a,onClick:function(){e.setState({pageNo:a})}})})))),v.a.createElement("div",{className:W.a.mask,onClick:i,style:{display:o?"block":"none"}})),B)}}]),t}(p.Component);G.propTypes={onSelect:E.a.func.isRequired,onClose:E.a.func.isRequired,emoji:E.a.object.isRequired,visible:E.a.bool},G.defaultProps={visible:!1};var Z,q=G,F=n(760),Q=n.n(F),K=140,Y=/(\[\S+?])/g,X=5e3,M=1,J=2,$=3,ee=4,te=(Z={},h()(Z,M,"student"),h()(Z,J,"teacher"),h()(Z,$,"assistant"),h()(Z,ee,"quality"),Z),ne=function(e){function t(){var e;return o()(this,t),(e=l()(this,_()(t).call(this))).componentDidMount=function(){e.announceDom&&(e.pos=e.announceDom.clientWidth)},e.componentWillUnmount=function(){clearTimeout(e.scrollTimer)},e.getRowHeight=function(t){var n=t.index,a=e.state.heights[n];return a?a+10:69},e.handleComposition=function(t){"compositionend"===t.type?(e.inComposition=!1,setTimeout(function(){e.handleTextChanged()},10)):e.inComposition=!0},e.toggleEmotion=function(){1===e.props.status&&e.setState({emotionShow:!e.state.emotionShow})},e.handleScrollUpdated=function(t){e.updateScrolled||(e.scrollClicked=!0,clearTimeout(e.scrollTimer),e.scrollTimer=setTimeout(function(){e.scrollClicked=!1},400))},e.updateScrollTop=function(t,n){if(!e.scrollClicked){var a=parseInt(t/1e3,10),o=e.props.chatData.map(function(e){return e.timestamp}),i=o.filter(function(e){return e<=a});if(0===i.length&&n)e.updateChatScroll(!1,0);else{var c=i.length,r=i[c-1<0?0:c-1];if(r&&(+r+X/1e3>=a||n)){var l=o.findIndex(function(e){return e===r});e.vList.scrollToRow(l),e.updateScrolled=!0}}}},e.updateChatScroll=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.scrollClicked&&!a||(t?e.vList.scrollToRow(e.props.chatData.length-1):e.vList.scrollToPosition(n))},e.handleEnterPressed=function(t){13!==t.keyCode||e.props.countdownNumber>0||(t.preventDefault(),e.handleSendText(t))},e.handleSendText=function(){var t=e.textInput.value.trim();""!==t&&("function"==typeof e.props.onSend&&e.props.onSend(t),e.textInput.value="",e.wordCount.innerHTML="".concat(e.textInput.value.length,"/").concat(K),e.textInput.focus())},e.handleTextChanged=function(){e.inComposition||(e.textInput.value.length>K&&(e.textInput.value=e.textInput.value.substring(0,K)),e.wordCount.innerHTML="".concat(e.textInput.value.length,"/").concat(K))},e.handleHeightReady=function(t,n){var a=e.state.heights;a[n]=t,e.setState({heights:a},function(){e.vList.recomputeRowHeights(n)})},e.hideAnnouncement=function(){e.setState({announcementVisible:!1})},e.hideEmoji=function(){e.setState({emotionShow:!1})},e.handleAvatarError=function(e){e.target.src=Q.a},e.selectEmoji=function(t){var n=e.textInput.value+t;if(e.textInput.value=n.length<=K?n:e.textInput.value,e.setState({emotionShow:!1}),e.wordCount.innerHTML="".concat(e.textInput.value.length,"/").concat(K),e.textInput.focus(),e.textInput.setSelectionRange){var a=e.textInput.value.length;e.textInput.setSelectionRange(a,a)}e.props.onSelectEmotion()},e.renderAnnounce=function(){var t=e.props.announceData.announce,n=void 0===t?"":t;return v.a.createElement("div",{className:k.a.radio__content},"公告：",n)},e.renderChat=function(t){var n,a,o=t.index,i=t.style,c=e.props,r=c.chatData,l=c.emoji,s=c.userToken,_=r[o],m=_.userIdentity,d=_.isError,u=_.name,h=_.msgData,p=_.portrait,g=_.recordId,E=_.fromUserToken,f=h.split(Y),b=d?"error":te[m],S=f.map(function(e,t){return""!==e?l[e]?v.a.createElement("img",{className:k.a["content-img"],src:l[e],alt:"",key:"".concat(t,"00")}):v.a.createElement("span",{key:"".concat(t,"11")},e):null}),w=Q.a;if(p&&(w=p.startsWith("http")?p:"//static.sunlands.com".concat(p)),E===s)n=v.a.createElement("div",{className:k.a["chat-title__me"]},v.a.createElement("span",{className:k.a["chat-name__me"]},"我"),v.a.createElement("div",{className:k.a.chat_avatar},v.a.createElement("img",{src:w,alt:"",onError:e.handleAvatarError}))),a=k.a["chat-content__me"];else{var A;switch(m){case M:A=k.a["chat-name__student"];break;case $:A=k.a["chat-name__assistant"];break;case J:A=k.a["chat-name__teacher"];break;case ee:A=k.a["chat-name__quality"];break;default:A=k.a["chat-name__student"]}n=v.a.createElement("div",{className:k.a["chat-title__other"]},v.a.createElement("div",{className:k.a.chat_avatar},v.a.createElement("img",{src:w,alt:"",onError:e.handleAvatarError})),v.a.createElement("span",{className:x()(A,k.a["chat-name"])},u)),a=k.a["chat-content__other"]}return v.a.createElement("div",{key:g,className:x()(k.a["msg-item"],k.a["msg-item-".concat(b)]),style:i},v.a.createElement(C.a,{onHeightReady:function(t){e.handleHeightReady(t,o)}},n,v.a.createElement("div",{className:a},S)))},e.state={emotionShow:!1,heights:[],announcementVisible:!0},e.pos=0,e}return d()(t,e),c()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.announceData;!N()(t,this.props.announceData)&&t&&this.setState({announcementVisible:!0})}},{key:"render",value:function(){var e,t,n=this,a=this.state,o=a.announcementVisible,i=a.emotionShow,c=this.props,r=c.announceData,l=c.emoji,s=c.status,_=c.countdownNumber,m=c.readOnly,d=c.iUserCount,u=c.chatData,g=this.hideAnnouncement,E=this.handleSendText,f=this.selectEmoji,w=this.hideEmoji,C=1!==s||_>0,A=[2,3].includes(s),N=_>0?"".concat(_):"发送";switch(s){case 0:t="直播间连接中。。。";break;case 1:t="说点什么吧~";break;case 2:t="您已被禁言",N="禁言";break;case 3:t="当前直播间已禁言",N="禁言";break;default:t="直播间连接中。。。"}return v.a.createElement("div",{className:k.a.panel},v.a.createElement("div",{className:k.a.title},v.a.createElement("div",{className:k.a.chat_icon}),v.a.createElement("div",{className:k.a.chat_title},"聊天"),v.a.createElement("div",{className:k.a.count},!!d&&v.a.createElement(p.Fragment,null,"（正在学习：",v.a.createElement("span",{style:{color:"#fff"}},d),"人）"))),o&&!!r&&!!r.announce&&v.a.createElement("div",{className:k.a.radio,ref:function(e){n.announceDom=e}},this.renderAnnounce(),v.a.createElement("div",{className:k.a["radio-close"],onClick:g})),v.a.createElement("div",{className:k.a.content},v.a.createElement(S.AutoSizer,null,function(e){var t=e.width,a=e.height;return v.a.createElement(b.List,{ref:function(e){n.vList=e},className:k.a["list-wrap"],width:t,height:a,overscanRowCount:30,rowCount:u.length,rowHeight:n.getRowHeight,rowRenderer:n.renderChat,onScroll:n.handleScrollUpdated})})),!m&&v.a.createElement("div",{className:k.a["input-box"]},v.a.createElement("div",{className:k.a["input-title"]},v.a.createElement("div",{className:k.a.emotion,onClick:this.toggleEmotion}),v.a.createElement("div",{className:k.a.words,ref:function(e){n.wordCount=e}},"0/",K)),v.a.createElement("div",{className:k.a["input-container"]},v.a.createElement("textarea",{ref:function(e){n.textInput=e},className:x()((e={},h()(e,k.a.textarea,1===s),h()(e,k.a.textarea_disabled,1!==s),e)),placeholder:t,onChange:this.handleTextChanged,onKeyDown:this.handleEnterPressed,onCompositionStart:this.handleComposition,onCompositionUpdate:this.handleComposition,onCompositionEnd:this.handleComposition,disabled:A}),v.a.createElement("button",{disabled:C,className:x()(k.a["send-btn"],h()({},k.a["send-btn-disable"],C)),onClick:E},N))),v.a.createElement(q,{emoji:l,onClose:w,onSelect:f,visible:i}))}}]),t}(p.Component);ne.propTypes={onSend:E.a.func,iUserCount:E.a.number,chatData:E.a.array,readOnly:E.a.bool,onSelectEmotion:E.a.func,emoji:E.a.object,userToken:E.a.string,status:E.a.oneOf([0,1,2,3]),announceData:E.a.object,countdownNumber:E.a.number},ne.defaultProps={readOnly:!1,iUserCount:0,onSend:function(){},chatData:[],announceData:null,onSelectEmotion:function(){},emoji:{},userToken:"",status:0,countdownNumber:0};t.default=ne}}]);
//# sourceMappingURL=2.9761e061b1bc1ea9f041.js.map